<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>InfluxDB PHP Client: influxdb-client-php</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">InfluxDB PHP Client
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">influxdb-client-php </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__r_e_a_d_m_e"></a></p>
<p><a href="https://circleci.com/gh/influxdata/influxdb-client-php"><img src="https://circleci.com/gh/influxdata/influxdb-client-php.svg?style=svg" alt="CircleCI" style="pointer-events: none;" class="inline"/></a> <a href="https://codecov.io/gh/influxdata/influxdb-client-php"><img src="https://codecov.io/gh/influxdata/influxdb-client-php/branch/master/graph/badge.svg" alt="codecov" style="pointer-events: none;" class="inline"/></a> <a href="https://packagist.org/packages/influxdata/influxdb-client-php"><img src="https://img.shields.io/packagist/v/influxdata/influxdb-client-php" alt="Packagist Version" class="inline"/></a> <a href="https://github.com/influxdata/influxdb-client-php/blob/master/LICENSE"><img src="https://img.shields.io/github/license/influxdata/influxdb-client-php.svg" alt="License" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/influxdata/influxdb-client-php/issues"><img src="https://img.shields.io/github/issues-raw/influxdata/influxdb-client-php.svg" alt="GitHub issues" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/influxdata/influxdb-client-php/pulls"><img src="https://img.shields.io/github/issues-pr-raw/influxdata/influxdb-client-php.svg" alt="GitHub pull requests" style="pointer-events: none;" class="inline"/></a> <img src="https://img.shields.io/packagist/php-v/influxdata/influxdb-client-php" alt="PHP from Packagist" class="inline"/> <a href="https://www.influxdata.com/slack"><img src="https://img.shields.io/badge/slack-join_chat-white.svg?logo=slack&amp;style=social" alt="Slack Status" style="pointer-events: none;" class="inline"/></a></p>
<p>This repository contains the reference PHP client for the InfluxDB 2.x.</p>
<h3><a class="anchor" id="autotoc_md1"></a>
Note: Use this client library with InfluxDB 2.x and InfluxDB 1.8+ (see details). For connecting to InfluxDB 1.7 or earlier instances, use the <a href="https://github.com/influxdata/influxdb-php">influxdb-php</a> client library.</h3>
<ul>
<li>Installation<ul>
<li>Install the library</li>
</ul>
</li>
<li>Usage<ul>
<li>Creating a client</li>
<li>Querying data</li>
<li>Writing data</li>
<li>Default Tags</li>
</ul>
</li>
<li>Advanced Usage<ul>
<li>Check the server status</li>
<li>InfluxDB 1.8 API compatibility</li>
<li>InfluxDB 2.x management API</li>
<li>Writing via UDP</li>
<li>Delete data</li>
<li>Proxy and redirects</li>
</ul>
</li>
<li>Contributing</li>
<li>License</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Documentation</h1>
<p>This section contains links to the client library documentation.</p>
<ul>
<li><a href="https://docs.influxdata.com/influxdb/latest/tools/client-libraries/">Product documentation</a>, Getting Started</li>
<li>[Examples](examples)</li>
<li><a href="https://influxdata.github.io/influxdb-client-php/">API Reference</a></li>
<li>Changelog</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Installation</h1>
<p>The client is not hard coupled to HTTP client library like Guzzle, Buzz or something else. The client uses general abstractions (<a href="https://www.php-fig.org/psr/psr-18/">PSR-7 - HTTP messages</a>, <a href="https://www.php-fig.org/psr/psr-18/">PSR-17 - HTTP factories</a>, <a href="https://www.php-fig.org/psr/psr-18/">PSR-18 - HTTP client</a>) which give you freedom to use your favorite one.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Install the library</h2>
<p>The InfluxDB 2 client is bundled and hosted on <a href="https://packagist.org/packages/influxdata/influxdb-client-php">https://packagist.org/</a> and can be installed with composer:</p>
<div class="fragment"><div class="line">composer require influxdata/influxdb-client-php guzzlehttp/guzzle</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md6"></a>
Creating a client</h2>
<p>Use <code><a class="el" href="namespace_influx_d_b2.html">InfluxDB2</a>\Client</code> to create a client connected to a running InfluxDB 2 instance.</p>
<div class="fragment"><div class="line">$client = <span class="keyword">new</span> <a class="code hl_class" href="class_influx_d_b2_1_1_client.html">InfluxDB2\Client</a>([</div>
<div class="line">    <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;http://localhost:8086&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;token&quot;</span> =&gt; <span class="stringliteral">&quot;my-token&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;bucket&quot;</span> =&gt; <span class="stringliteral">&quot;my-bucket&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;org&quot;</span> =&gt; <span class="stringliteral">&quot;my-org&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;precision&quot;</span> =&gt; <a class="code hl_namespace" href="namespace_influx_d_b2.html">InfluxDB2</a>\Model\WritePrecision::NS</div>
<div class="line">]);</div>
<div class="ttc" id="aclass_influx_d_b2_1_1_client_html"><div class="ttname"><a href="class_influx_d_b2_1_1_client.html">InfluxDB2\Client</a></div><div class="ttdef"><b>Definition</b> Client.php:14</div></div>
<div class="ttc" id="anamespace_influx_d_b2_html"><div class="ttname"><a href="namespace_influx_d_b2.html">InfluxDB2</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md7"></a>
Client Options</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Option   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Note   </th><th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Default    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>url</b>   </td><td class="markdownTableBodyNone">InfluxDB server API url (e.g. <a href="http://localhost:8086">http://localhost:8086</a>)   </td><td class="markdownTableBodyNone"><b>required</b>   </td><td class="markdownTableBodyNone">String   </td><td class="markdownTableBodyNone">none    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>token</b>   </td><td class="markdownTableBodyNone">Token to use for the authorization   </td><td class="markdownTableBodyNone"><b>required</b>   </td><td class="markdownTableBodyNone">String   </td><td class="markdownTableBodyNone">none    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">bucket   </td><td class="markdownTableBodyNone">Default destination bucket for writes   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">String   </td><td class="markdownTableBodyNone">none    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">org   </td><td class="markdownTableBodyNone">Default destination organization for writes   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">String   </td><td class="markdownTableBodyNone">none    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">precision   </td><td class="markdownTableBodyNone">Default precision for the unix timestamps within the body line-protocol   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">String   </td><td class="markdownTableBodyNone">none    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">allow_redirects   </td><td class="markdownTableBodyNone">Enable HTTP redirects   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">bool   </td><td class="markdownTableBodyNone">true    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">debug   </td><td class="markdownTableBodyNone">Enable verbose logging of http requests   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">bool   </td><td class="markdownTableBodyNone">false    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">logFile   </td><td class="markdownTableBodyNone">Default output for logs   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">bool   </td><td class="markdownTableBodyNone">php://output    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">httpClient   </td><td class="markdownTableBodyNone">Configured HTTP client to use for communication with InfluxDB   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><code>Psr\Http\Client\ClientInterface</code>   </td><td class="markdownTableBodyNone">none    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">verifySSL   </td><td class="markdownTableBodyNone">Turn on/off SSL certificate verification. Set to <code>false</code> to disable certificate verification.   </td><td class="markdownTableBodyNone">:warning: required <code>Guzzle</code> HTTP client   </td><td class="markdownTableBodyNone">bool   </td><td class="markdownTableBodyNone">true    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">timeout   </td><td class="markdownTableBodyNone">Describing the number of seconds to wait while trying to connect to a server. Use 0 to wait indefinitely.   </td><td class="markdownTableBodyNone">:warning: required <code>Guzzle</code> HTTP client   </td><td class="markdownTableBodyNone">int   </td><td class="markdownTableBodyNone">10    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">proxy   </td><td class="markdownTableBodyNone">specify an HTTP proxy, or an array to specify different proxies for different protocols.   </td><td class="markdownTableBodyNone">:warning: required <code>Guzzle</code> HTTP client   </td><td class="markdownTableBodyNone">string   </td><td class="markdownTableBodyNone">none   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md8"></a>
Custom HTTP client</h3>
<p>The following code shows how to use and configure <a href="https://github.com/php-http/curl-client">cURL</a> HTTP client:</p>
<h4><a class="anchor" id="autotoc_md9"></a>
Install dependencies via composer</h4>
<div class="fragment"><div class="line">composer require influxdata/influxdb-client-php nyholm/psr7 php-http/curl-client</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md10"></a>
Configure cURL client</h4>
<div class="fragment"><div class="line">$curlOptions = [</div>
<div class="line">    CURLOPT_CONNECTTIMEOUT =&gt; 30, <span class="comment">// The number of seconds to wait while trying to connect.</span></div>
<div class="line">];</div>
<div class="line">$curlClient = <span class="keyword">new</span> Http\Client\Curl\Client(</div>
<div class="line">    Http\Discovery\Psr17FactoryDiscovery::findRequestFactory(),</div>
<div class="line">    Http\Discovery\Psr17FactoryDiscovery::findStreamFactory(),</div>
<div class="line">    $curlOptions</div>
<div class="line">);</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md11"></a>
Initialize InfluxDB client</h4>
<div class="fragment"><div class="line">$client = <span class="keyword">new</span> Client([</div>
<div class="line">    <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;http://localhost:8086&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;token&quot;</span> =&gt; <span class="stringliteral">&quot;my-token&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;bucket&quot;</span> =&gt; <span class="stringliteral">&quot;my-bucket&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;org&quot;</span> =&gt; <span class="stringliteral">&quot;my-org&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;httpClient&quot;</span> =&gt; $curlClient</div>
<div class="line">]);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md12"></a>
Queries</h2>
<p>The result retrieved by <a href="https://github.com/influxdata/influxdb-client-php/blob/master/src/InfluxDB2/QueryApi.php">QueryApi</a> could be formatted as a:</p>
<ol type="1">
<li>Raw query response</li>
<li>Flux data structure: <a href="https://github.com/influxdata/influxdb-client-php/blob/master/src/InfluxDB2/FluxTable.php">FluxTable</a>, <a href="https://github.com/influxdata/influxdb-client-php/blob/master/src/InfluxDB2/FluxColumn.php">FluxColumn</a> and <a href="https://github.com/influxdata/influxdb-client-php/blob/master/src/InfluxDB2/FluxRecord.php">FluxRecord</a></li>
<li>Stream of <a href="https://github.com/influxdata/influxdb-client-php/blob/master/src/InfluxDB2/FluxRecord.php">FluxRecord</a></li>
</ol>
<h3><a class="anchor" id="autotoc_md13"></a>
Query raw</h3>
<p>Synchronously executes the Flux query and return result as unprocessed String </p><div class="fragment"><div class="line">$this-&gt;client = <span class="keyword">new</span> Client([</div>
<div class="line">    <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;http://localhost:8086&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;token&quot;</span> =&gt; <span class="stringliteral">&quot;my-token&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;bucket&quot;</span> =&gt; <span class="stringliteral">&quot;my-bucket&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;precision&quot;</span> =&gt; WritePrecision::NS,</div>
<div class="line">    <span class="stringliteral">&quot;org&quot;</span> =&gt; <span class="stringliteral">&quot;my-org&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;debug&quot;</span> =&gt; <span class="keyword">false</span></div>
<div class="line">]);</div>
<div class="line"> </div>
<div class="line">$this-&gt;queryApi = $this-&gt;client-&gt;createQueryApi();</div>
<div class="line"> </div>
<div class="line">$result = $this-&gt;queryApi-&gt;queryRaw(</div>
<div class="line">            <span class="stringliteral">&#39;from(bucket:&quot;my-bucket&quot;) |&gt; range(start: 1970-01-01T00:00:00.000000001Z) |&gt; last()&#39;</span>);</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md14"></a>
Synchronous query</h3>
<p>Synchronously executes the Flux query and return result as a Array of <a href="https://github.com/influxdata/influxdb-client-php/blob/master/src/InfluxDB2/FluxTable.php">FluxTables</a> </p><div class="fragment"><div class="line">$this-&gt;client = <span class="keyword">new</span> Client([</div>
<div class="line">    <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;http://localhost:8086&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;token&quot;</span> =&gt; <span class="stringliteral">&quot;my-token&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;bucket&quot;</span> =&gt; <span class="stringliteral">&quot;my-bucket&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;precision&quot;</span> =&gt; WritePrecision::NS,</div>
<div class="line">    <span class="stringliteral">&quot;org&quot;</span> =&gt; <span class="stringliteral">&quot;my-org&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;debug&quot;</span> =&gt; <span class="keyword">false</span></div>
<div class="line">]);</div>
<div class="line"> </div>
<div class="line">$this-&gt;queryApi = $this-&gt;client-&gt;createQueryApi();</div>
<div class="line"> </div>
<div class="line">$result = $this-&gt;queryApi-&gt;query(</div>
<div class="line">            <span class="stringliteral">&#39;from(bucket:&quot;my-bucket&quot;) |&gt; range(start: 1970-01-01T00:00:00.000000001Z) |&gt; last()&#39;</span>);</div>
</div><!-- fragment --><p> This can then easily be encoded to JSON with <a href="https://www.php.net/manual/en/function.json-encode.php">json_encode</a> </p><div class="fragment"><div class="line">header(<span class="stringliteral">&#39;Content-type:application/json;charset=utf-8&#39;</span>);</div>
<div class="line">echo json_encode( $result, JSON_PRETTY_PRINT ) ;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md15"></a>
Query stream</h3>
<p>Synchronously executes the Flux query and return stream of <a href="https://github.com/influxdata/influxdb-client-php/blob/master/src/InfluxDB2/FluxRecord.php">FluxRecord</a> </p><div class="fragment"><div class="line">$this-&gt;client = <span class="keyword">new</span> Client([</div>
<div class="line">    <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;http://localhost:8086&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;token&quot;</span> =&gt; <span class="stringliteral">&quot;my-token&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;bucket&quot;</span> =&gt; <span class="stringliteral">&quot;my-bucket&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;precision&quot;</span> =&gt; WritePrecision::NS,</div>
<div class="line">    <span class="stringliteral">&quot;org&quot;</span> =&gt; <span class="stringliteral">&quot;my-org&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;debug&quot;</span> =&gt; <span class="keyword">false</span></div>
<div class="line">]);</div>
<div class="line"> </div>
<div class="line">$this-&gt;queryApi = $this-&gt;client-&gt;createQueryApi();</div>
<div class="line"> </div>
<div class="line">$parser = $this-&gt;queryApi-&gt;queryStream(</div>
<div class="line">            <span class="stringliteral">&#39;from(bucket:&quot;my-bucket&quot;) |&gt; range(start: 1970-01-01T00:00:00.000000001Z) |&gt; last()&#39;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">foreach</span> ($parser-&gt;each() as $record)</div>
<div class="line">{</div>
<div class="line">    ...</div>
<div class="line">}</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md16"></a>
Parameterized queries</h2>
<p>InfluxDB Cloud supports <a href="https://docs.influxdata.com/influxdb/cloud/query-data/parameterized-queries/">Parameterized Queries</a> that let you dynamically change values in a query using the InfluxDB API. Parameterized queries make Flux queries more reusable and can also be used to help prevent injection attacks.</p>
<p>InfluxDB Cloud inserts the params object into the Flux query as a Flux record named <code>params</code>. Use dot or bracket notation to access parameters in the <code>params</code> record in your Flux query. Parameterized Flux queries support only <code>int</code> , <code>float</code>, and <code>string</code> data types. To convert the supported data types into other <a href="https://docs.influxdata.com/influxdb/cloud/query-data/parameterized-queries/#supported-parameter-data-types">Flux basic data types, use Flux type conversion functions</a>.</p>
<p>Parameterized query example: </p><blockquote class="doxtable">
<p>:warning: Parameterized Queries are supported only in InfluxDB Cloud, currently there is no support in InfluxDB OSS. </p>
</blockquote>
<div class="fragment"><div class="line">&lt;?php</div>
<div class="line">require __DIR__ . <span class="stringliteral">&#39;/../vendor/autoload.php&#39;</span>;</div>
<div class="line"> </div>
<div class="line">use <a class="code hl_class" href="class_influx_d_b2_1_1_client.html">InfluxDB2\Client</a>;</div>
<div class="line">use <a class="code hl_class" href="class_influx_d_b2_1_1_model_1_1_query.html">InfluxDB2\Model\Query</a>;</div>
<div class="line">use <a class="code hl_class" href="class_influx_d_b2_1_1_point.html">InfluxDB2\Point</a>;</div>
<div class="line">use <a class="code hl_class" href="class_influx_d_b2_1_1_write_type.html">InfluxDB2\WriteType</a> as WriteType;</div>
<div class="line"> </div>
<div class="line">$url = <span class="stringliteral">&quot;https://us-west-2-1.aws.cloud2.influxdata.com&quot;</span>;</div>
<div class="line">$organization = <span class="stringliteral">&#39;my-org&#39;</span>;</div>
<div class="line">$bucket = <span class="stringliteral">&#39;my-bucket&#39;</span>;</div>
<div class="line">$token = <span class="stringliteral">&#39;my-token&#39;</span>;</div>
<div class="line"> </div>
<div class="line">$client = <span class="keyword">new</span> Client([</div>
<div class="line">    <span class="stringliteral">&quot;url&quot;</span> =&gt; $url,</div>
<div class="line">    <span class="stringliteral">&quot;token&quot;</span> =&gt; $token,</div>
<div class="line">    <span class="stringliteral">&quot;bucket&quot;</span> =&gt; $bucket,</div>
<div class="line">    <span class="stringliteral">&quot;org&quot;</span> =&gt; $organization,</div>
<div class="line">    <span class="stringliteral">&quot;precision&quot;</span> =&gt; <a class="code hl_namespace" href="namespace_influx_d_b2.html">InfluxDB2</a>\Model\WritePrecision::NS,</div>
<div class="line">    <span class="stringliteral">&quot;debug&quot;</span> =&gt; <span class="keyword">false</span></div>
<div class="line">]);</div>
<div class="line"> </div>
<div class="line">$writeApi = $client-&gt;createWriteApi([<span class="stringliteral">&quot;writeType&quot;</span> =&gt; WriteType::SYNCHRONOUS]);</div>
<div class="line">$queryApi = $client-&gt;createQueryApi();</div>
<div class="line"> </div>
<div class="line">$today = <span class="keyword">new</span> DateTime(<span class="stringliteral">&quot;now&quot;</span>);</div>
<div class="line">$yesterday = $today-&gt;sub(<span class="keyword">new</span> DateInterval(<span class="stringliteral">&quot;P1D&quot;</span>));</div>
<div class="line"> </div>
<div class="line">$p = <span class="keyword">new</span> Point(<span class="stringliteral">&quot;temperature&quot;</span>);</div>
<div class="line">$p-&gt;addTag(<span class="stringliteral">&quot;location&quot;</span>, <span class="stringliteral">&quot;north&quot;</span>)-&gt;addField(<span class="stringliteral">&quot;value&quot;</span>, 60)-&gt;time($yesterday);</div>
<div class="line">$writeApi-&gt;write($p);</div>
<div class="line">$writeApi-&gt;close();</div>
<div class="line"> </div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Query range start parameter using duration</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">$parameterizedQuery = <span class="stringliteral">&quot;from(bucket: params.bucketParam) |&gt; range(start: duration(v: params.startParam))&quot;</span>;</div>
<div class="line">$query = <span class="keyword">new</span> Query();</div>
<div class="line">$query-&gt;setQuery($parameterizedQuery);</div>
<div class="line">$query-&gt;setParams([<span class="stringliteral">&quot;bucketParam&quot;</span> =&gt; <span class="stringliteral">&quot;my-bucket&quot;</span>, <span class="stringliteral">&quot;startParam&quot;</span> =&gt; <span class="stringliteral">&quot;-1d&quot;</span>]);</div>
<div class="line">$tables = $queryApi-&gt;query($query);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">foreach</span> ($tables as $table) {</div>
<div class="line">    <span class="keywordflow">foreach</span> ($table-&gt;records as $record) {</div>
<div class="line">        var_export($record-&gt;values);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Query range start parameter using DateTime</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">$parameterizedQuery = <span class="stringliteral">&quot;from(bucket: params.bucketParam) |&gt; range(start: time(v: params.startParam))&quot;</span>;</div>
<div class="line">$query-&gt;setParams([<span class="stringliteral">&quot;bucketParam&quot;</span> =&gt; <span class="stringliteral">&quot;my-bucket&quot;</span>, <span class="stringliteral">&quot;startParam&quot;</span> =&gt; $yesterday]);</div>
<div class="line">$query-&gt;setQuery($parameterizedQuery);</div>
<div class="line">$tables = $queryApi-&gt;query($query);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">foreach</span> ($tables as $table) {</div>
<div class="line">    <span class="keywordflow">foreach</span> ($table-&gt;records as $record) {</div>
<div class="line">        var_export($record-&gt;values);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">$client-&gt;close();</div>
<div class="ttc" id="aclass_influx_d_b2_1_1_model_1_1_query_html"><div class="ttname"><a href="class_influx_d_b2_1_1_model_1_1_query.html">InfluxDB2\Model\Query</a></div><div class="ttdef"><b>Definition</b> Query.php:45</div></div>
<div class="ttc" id="aclass_influx_d_b2_1_1_point_html"><div class="ttname"><a href="class_influx_d_b2_1_1_point.html">InfluxDB2\Point</a></div><div class="ttdef"><b>Definition</b> Point.php:9</div></div>
<div class="ttc" id="aclass_influx_d_b2_1_1_write_type_html"><div class="ttname"><a href="class_influx_d_b2_1_1_write_type.html">InfluxDB2\WriteType</a></div><div class="ttdef"><b>Definition</b> WriteType.php:6</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md17"></a>
Writing data</h2>
<p>The <a href="https://github.com/influxdata/influxdb-client-php/blob/master/src/InfluxDB2/WriteApi.php">WriteApi</a> supports synchronous and batching writes into InfluxDB 2.x. In default api uses synchronous write. To enable batching you can use WriteOption.</p>
<div class="fragment"><div class="line">$client = <span class="keyword">new</span> <a class="code hl_class" href="class_influx_d_b2_1_1_client.html">InfluxDB2\Client</a>([<span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;http://localhost:8086&quot;</span>, <span class="stringliteral">&quot;token&quot;</span> =&gt; <span class="stringliteral">&quot;my-token&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;bucket&quot;</span> =&gt; <span class="stringliteral">&quot;my-bucket&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;org&quot;</span> =&gt; <span class="stringliteral">&quot;my-org&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;precision&quot;</span> =&gt; <a class="code hl_namespace" href="namespace_influx_d_b2.html">InfluxDB2</a>\Model\WritePrecision::NS</div>
<div class="line">]);</div>
<div class="line">$write_api = $client-&gt;createWriteApi();</div>
<div class="line">$write_api-&gt;write(<span class="stringliteral">&#39;h2o,location=west value=33i 15&#39;</span>);</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md18"></a>
Batching</h3>
<p>The writes are processed in batches which are configurable by <code>WriteOptions</code>:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Property   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Default Value    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>writeType</b>   </td><td class="markdownTableBodyNone">type of write SYNCHRONOUS / BATCHING /   </td><td class="markdownTableBodyNone">SYNCHRONOUS    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>batchSize</b>   </td><td class="markdownTableBodyNone">the number of data point to collect in batch   </td><td class="markdownTableBodyNone">10    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>retryInterval</b>   </td><td class="markdownTableBodyNone">the number of milliseconds to retry unsuccessful write. The retry interval is "exponentially" used when the InfluxDB server does not specify "Retry-After" header.   </td><td class="markdownTableBodyNone">5000    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>jitterInterval</b>   </td><td class="markdownTableBodyNone">the number of milliseconds before the data is written increased by a random amount   </td><td class="markdownTableBodyNone">0    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>maxRetries</b>   </td><td class="markdownTableBodyNone">the number of max retries when write fails   </td><td class="markdownTableBodyNone">5    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>maxRetryDelay</b>   </td><td class="markdownTableBodyNone">maximum delay when retrying write in milliseconds   </td><td class="markdownTableBodyNone">125000    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>maxRetryTime</b>   </td><td class="markdownTableBodyNone">maximum total retry timeout in milliseconds   </td><td class="markdownTableBodyNone">180000    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>exponentialBase</b>   </td><td class="markdownTableBodyNone">the base for the exponential retry delay, the next delay is computed using random exponential backoff as a random value within the interval <code>retryInterval * exponentialBase^(attempts-1)</code> and <code>retryInterval * exponentialBase^(attempts)</code>. Example for <code>retryInterval=5000, exponentialBase=2, maxRetryDelay=125000, total=5</code> Retry delays are random distributed values within the ranges of <code>[5000-10000, 10000-20000, 20000-40000, 40000-80000, 80000-125000]</code>   </td><td class="markdownTableBodyNone">2   </td></tr>
</table>
<div class="fragment"><div class="line">use <a class="code hl_class" href="class_influx_d_b2_1_1_client.html">InfluxDB2\Client</a>;</div>
<div class="line">use <a class="code hl_class" href="class_influx_d_b2_1_1_write_type.html">InfluxDB2\WriteType</a> as WriteType;</div>
<div class="line"> </div>
<div class="line">$client = <span class="keyword">new</span> Client([<span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;http://localhost:8086&quot;</span>, <span class="stringliteral">&quot;token&quot;</span> =&gt; <span class="stringliteral">&quot;my-token&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;bucket&quot;</span> =&gt; <span class="stringliteral">&quot;my-bucket&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;org&quot;</span> =&gt; <span class="stringliteral">&quot;my-org&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;precision&quot;</span> =&gt; <a class="code hl_namespace" href="namespace_influx_d_b2.html">InfluxDB2</a>\Model\WritePrecision::NS</div>
<div class="line">]);</div>
<div class="line"> </div>
<div class="line">$writeApi = $client-&gt;createWriteApi(</div>
<div class="line">    [<span class="stringliteral">&quot;writeType&quot;</span> =&gt; WriteType::BATCHING, <span class="stringliteral">&#39;batchSize&#39;</span> =&gt; 1000]);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">foreach</span> (range(1, 10000) as $number) {</div>
<div class="line">    $writeApi-&gt;write(<span class="stringliteral">&quot;mem,host=aws_europe,type=batch value=1i $number&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// flush remaining data</span></div>
<div class="line">$writeApi-&gt;close();</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md19"></a>
Time precision</h3>
<p>Configure default time precision: </p><div class="fragment"><div class="line">$client = <span class="keyword">new</span> <a class="code hl_class" href="class_influx_d_b2_1_1_client.html">InfluxDB2\Client</a>([<span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;http://localhost:8086&quot;</span>, <span class="stringliteral">&quot;token&quot;</span> =&gt; <span class="stringliteral">&quot;my-token&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;bucket&quot;</span> =&gt; <span class="stringliteral">&quot;my-bucket&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;org&quot;</span> =&gt; <span class="stringliteral">&quot;my-org&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;precision&quot;</span> =&gt; \<a class="code hl_namespace" href="namespace_influx_d_b2.html">InfluxDB2</a>\Model\WritePrecision::NS</div>
<div class="line">]);</div>
</div><!-- fragment --><p>Configure precision per write: </p><div class="fragment"><div class="line">$client = <span class="keyword">new</span> <a class="code hl_class" href="class_influx_d_b2_1_1_client.html">InfluxDB2\Client</a>([</div>
<div class="line">    <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;http://localhost:8086&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;token&quot;</span> =&gt; <span class="stringliteral">&quot;my-token&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;bucket&quot;</span> =&gt; <span class="stringliteral">&quot;my-bucket&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;org&quot;</span> =&gt; <span class="stringliteral">&quot;my-org&quot;</span>,</div>
<div class="line">]);</div>
<div class="line"> </div>
<div class="line">$writeApi = $client-&gt;createWriteApi();</div>
<div class="line">$writeApi-&gt;write(<span class="stringliteral">&#39;h2o,location=west value=33i 15&#39;</span>, \<a class="code hl_namespace" href="namespace_influx_d_b2.html">InfluxDB2</a>\Model\WritePrecision::MS);</div>
</div><!-- fragment --><p> Allowed values for precision are:</p>
<ul>
<li><code>WritePrecision::NS</code> for nanosecond</li>
<li><code>WritePrecision::US</code> for microsecond</li>
<li><code>WritePrecision::MS</code> for millisecond</li>
<li><code>WritePrecision::S</code> for second</li>
</ul>
<h3><a class="anchor" id="autotoc_md20"></a>
Configure destination</h3>
<p>Default <code>bucket</code> and <code>organization</code> destination are configured via <code><a class="el" href="namespace_influx_d_b2.html">InfluxDB2</a>\Client</code>:</p>
<div class="fragment"><div class="line">$client = <span class="keyword">new</span> <a class="code hl_class" href="class_influx_d_b2_1_1_client.html">InfluxDB2\Client</a>([</div>
<div class="line">    <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;http://localhost:8086&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;token&quot;</span> =&gt; <span class="stringliteral">&quot;my-token&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;bucket&quot;</span> =&gt; <span class="stringliteral">&quot;my-bucket&quot;</span>,</div>
<div class="line">]);</div>
</div><!-- fragment --><p>but there is also possibility to override configuration per write:</p>
<div class="fragment"><div class="line">$client = <span class="keyword">new</span> <a class="code hl_class" href="class_influx_d_b2_1_1_client.html">InfluxDB2\Client</a>([<span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;http://localhost:8086&quot;</span>, <span class="stringliteral">&quot;token&quot;</span> =&gt; <span class="stringliteral">&quot;my-token&quot;</span>]);</div>
<div class="line"> </div>
<div class="line">$writeApi = $client-&gt;createWriteApi();</div>
<div class="line">$writeApi-&gt;write(<span class="stringliteral">&#39;h2o,location=west value=33i 15&#39;</span>, \<a class="code hl_namespace" href="namespace_influx_d_b2.html">InfluxDB2</a>\Model\WritePrecision::MS, <span class="stringliteral">&quot;production-bucket&quot;</span>, <span class="stringliteral">&quot;customer-1&quot;</span>);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21"></a>
Data format</h3>
<p>The data could be written as:</p>
<ol type="1">
<li><code>string</code> that is formatted as a InfluxDB's line protocol</li>
</ol>
<ol type="1">
<li><code>array</code> with keys: name, tags, fields and time</li>
</ol>
<ol type="1">
<li><a href="https://github.com/influxdata/influxdb-client-php/blob/master/src/InfluxDB2/Point.php">Data Point</a> structure</li>
</ol>
<ol type="1">
<li><code>Array</code> of above items</li>
</ol>
<div class="fragment"><div class="line">$client = <span class="keyword">new</span> <a class="code hl_class" href="class_influx_d_b2_1_1_client.html">InfluxDB2\Client</a>([</div>
<div class="line">    <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;http://localhost:8086&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;token&quot;</span> =&gt; <span class="stringliteral">&quot;my-token&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;bucket&quot;</span> =&gt; <span class="stringliteral">&quot;my-bucket&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;org&quot;</span> =&gt; <span class="stringliteral">&quot;my-org&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;precision&quot;</span> =&gt; <a class="code hl_namespace" href="namespace_influx_d_b2.html">InfluxDB2</a>\Model\WritePrecision::US</div>
<div class="line">]);</div>
<div class="line"> </div>
<div class="line">$writeApi = $client-&gt;createWriteApi();</div>
<div class="line"> </div>
<div class="line"><span class="comment">//data in Point structure</span></div>
<div class="line">$point=InfluxDB2\Point::measurement(<span class="stringliteral">&quot;h2o&quot;</span>)</div>
<div class="line">    -&gt;addTag(<span class="stringliteral">&quot;location&quot;</span>, <span class="stringliteral">&quot;europe&quot;</span>)</div>
<div class="line">    -&gt;addField(<span class="stringliteral">&quot;level&quot;</span>,2)</div>
<div class="line">    -&gt;time(microtime(<span class="keyword">true</span>));</div>
<div class="line"> </div>
<div class="line">$writeApi-&gt;write($point);</div>
<div class="line"> </div>
<div class="line"><span class="comment">//data in array structure</span></div>
<div class="line">$dataArray = [<span class="stringliteral">&#39;name&#39;</span> =&gt; <span class="stringliteral">&#39;cpu&#39;</span>, </div>
<div class="line">    <span class="stringliteral">&#39;tags&#39;</span> =&gt; [<span class="stringliteral">&#39;host&#39;</span> =&gt; <span class="stringliteral">&#39;server_nl&#39;</span>, <span class="stringliteral">&#39;region&#39;</span> =&gt; <span class="stringliteral">&#39;us&#39;</span>],</div>
<div class="line">    <span class="stringliteral">&#39;fields&#39;</span> =&gt; [<span class="stringliteral">&#39;internal&#39;</span> =&gt; 5, <span class="stringliteral">&#39;external&#39;</span> =&gt; 6],</div>
<div class="line">    <span class="stringliteral">&#39;time&#39;</span> =&gt; microtime(<span class="keyword">true</span>)];</div>
<div class="line"> </div>
<div class="line">$writeApi-&gt;write($dataArray);</div>
<div class="line"> </div>
<div class="line"><span class="comment">//write lineprotocol</span></div>
<div class="line">$writeApi-&gt;write(<span class="stringliteral">&#39;h2o,location=west value=33i 15&#39;</span>);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md22"></a>
Default Tags</h3>
<p>Sometimes is useful to store same information in every measurement e.g. <code>hostname</code>, <code>location</code>, <code>customer</code>. The client is able to use static value, app settings or env variable as a tag value.</p>
<p>The expressions:</p><ul>
<li><code>California Miner</code> - static value</li>
<li><code>${env.hostname}</code> - environment property</li>
</ul>
<h4><a class="anchor" id="autotoc_md23"></a>
Via API</h4>
<div class="fragment"><div class="line">$this-&gt;client = <span class="keyword">new</span> Client([</div>
<div class="line">    <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;http://localhost:8086&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;token&quot;</span> =&gt; <span class="stringliteral">&quot;my-token&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;bucket&quot;</span> =&gt; <span class="stringliteral">&quot;my-bucket&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;precision&quot;</span> =&gt; WritePrecision::NS,</div>
<div class="line">    <span class="stringliteral">&quot;org&quot;</span> =&gt; <span class="stringliteral">&quot;my-org&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;tags&quot;</span> =&gt; [<span class="stringliteral">&#39;id&#39;</span> =&gt; <span class="stringliteral">&#39;132-987-655&#39;</span>, </div>
<div class="line">        <span class="stringliteral">&#39;hostname&#39;</span> =&gt; <span class="stringliteral">&#39;${env.Hostname}&#39;</span>]</div>
<div class="line">]);</div>
<div class="line"> </div>
<div class="line">$writeApi = $this-&gt;client-&gt;createWriteApi(<span class="keyword">null</span>, [<span class="stringliteral">&#39;data_center&#39;</span> =&gt; <span class="stringliteral">&#39;${env.data_center}&#39;</span>]);</div>
<div class="line">    </div>
<div class="line">$writeApi-&gt;pointSettings-&gt;addDefaultTag(<span class="stringliteral">&#39;customer&#39;</span>, <span class="stringliteral">&#39;California Miner&#39;</span>);</div>
<div class="line"> </div>
<div class="line">$point = Point::measurement(<span class="stringliteral">&#39;h2o&#39;</span>)</div>
<div class="line">            -&gt;addTag(<span class="stringliteral">&#39;location&#39;</span>, <span class="stringliteral">&#39;europe&#39;</span>)</div>
<div class="line">            -&gt;addField(<span class="stringliteral">&#39;level&#39;</span>, 2);</div>
<div class="line"> </div>
<div class="line">$this-&gt;writeApi-&gt;write($point);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md24"></a>
Advanced Usage</h1>
<h2><a class="anchor" id="autotoc_md25"></a>
Check the server status</h2>
<p>Server availability can be checked using the <code>$client-&gt;ping();</code> method. That is equivalent of the <a href="https://docs.influxdata.com/influxdb/latest/reference/cli/influx/ping/">influx ping</a>.</p>
<h2><a class="anchor" id="autotoc_md26"></a>
InfluxDB 1.8 API compatibility</h2>
<p><a href="https://docs.influxdata.com/influxdb/v1.8/tools/api/#influxdb-2-0-api-compatibility-endpoints">InfluxDB 1.8.0 introduced forward compatibility APIs</a> for InfluxDB 2.x. This allow you to easily move from InfluxDB 1.x to InfluxDB 2.x Cloud or open source.</p>
<p>The following forward compatible APIs are available:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">API   </th><th class="markdownTableHeadLeft">Endpoint   </th><th class="markdownTableHeadLeft">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a href="src/InfluxDB2/QueryApi.php">QueryApi.php</a>   </td><td class="markdownTableBodyLeft"><a href="https://docs.influxdata.com/influxdb/latest/tools/api/#api-v2-query-http-endpoint">/api/v2/query</a>   </td><td class="markdownTableBodyLeft">Query data in InfluxDB 1.8.0+ using the InfluxDB 2.x API and <a href="https://docs.influxdata.com/flux/latest/">Flux</a> <em>(endpoint should be enabled by <a href="https://docs.influxdata.com/influxdb/latest/administration/config/#flux-enabled-false"><code>flux-enabled</code> option</a>)</em>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><a href="src/InfluxDB2/WriteApi.php">WriteApi.php</a>   </td><td class="markdownTableBodyLeft"><a href="https://docs.influxdata.com/influxdb/latest/tools/api/#api-v2-write-http-endpoint">/api/v2/write</a>   </td><td class="markdownTableBodyLeft">Write data to InfluxDB 1.8.0+ using the InfluxDB 2.x API    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a href="src/InfluxDB2/HealthApi.php">HealthApi.php</a>   </td><td class="markdownTableBodyLeft"><a href="https://docs.influxdata.com/influxdb/latest/tools/api/#health-http-endpoint">/health</a>   </td><td class="markdownTableBodyLeft">Check the health of your InfluxDB instance   </td></tr>
</table>
<p>For detail info see <a href="examples/InfluxDB_18_Example.php">InfluxDB 1.8 example</a>.</p>
<h2><a class="anchor" id="autotoc_md27"></a>
InfluxDB 2.x management API</h2>
<p>InfluxDB 2.x API client is generated using <a href="https://github.com/bonitoo-io/influxdb-clients-apigen"><code>influxdb-clients-apigen</code></a>. Sources are in <code><a class="el" href="namespace_influx_d_b2.html">InfluxDB2</a>\Service\</code> and <code><a class="el" href="namespace_influx_d_b2.html">InfluxDB2</a>\Model\</code> packages.</p>
<p>The following example shows how to use <code>OrganizationService</code> and <code>BucketService</code> to create a new bucket. <br  />
</p>
<div class="fragment"><div class="line">require __DIR__ . <span class="stringliteral">&#39;/../vendor/autoload.php&#39;</span>;</div>
<div class="line"> </div>
<div class="line">use <a class="code hl_class" href="class_influx_d_b2_1_1_client.html">InfluxDB2\Client</a>;</div>
<div class="line">use <a class="code hl_class" href="class_influx_d_b2_1_1_model_1_1_bucket_retention_rules.html">InfluxDB2\Model\BucketRetentionRules</a>;</div>
<div class="line">use <a class="code hl_class" href="class_influx_d_b2_1_1_model_1_1_organization.html">InfluxDB2\Model\Organization</a>;</div>
<div class="line">use <a class="code hl_class" href="class_influx_d_b2_1_1_model_1_1_post_bucket_request.html">InfluxDB2\Model\PostBucketRequest</a>;</div>
<div class="line">use <a class="code hl_class" href="class_influx_d_b2_1_1_service_1_1_buckets_service.html">InfluxDB2\Service\BucketsService</a>;</div>
<div class="line">use <a class="code hl_class" href="class_influx_d_b2_1_1_service_1_1_organizations_service.html">InfluxDB2\Service\OrganizationsService</a>;</div>
<div class="line"> </div>
<div class="line">$organization = <span class="stringliteral">&#39;my-org&#39;</span>;</div>
<div class="line">$bucket = <span class="stringliteral">&#39;my-bucket&#39;</span>;</div>
<div class="line">$token = <span class="stringliteral">&#39;my-token&#39;</span>;</div>
<div class="line"> </div>
<div class="line">$client = <span class="keyword">new</span> Client([</div>
<div class="line">    <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;http://localhost:8086&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;token&quot;</span> =&gt; $token,</div>
<div class="line">    <span class="stringliteral">&quot;bucket&quot;</span> =&gt; $bucket,</div>
<div class="line">    <span class="stringliteral">&quot;org&quot;</span> =&gt; $organization,</div>
<div class="line">    <span class="stringliteral">&quot;precision&quot;</span> =&gt; <a class="code hl_namespace" href="namespace_influx_d_b2.html">InfluxDB2</a>\Model\WritePrecision::S</div>
<div class="line">]);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">function</span> findMyOrg($client): ?Organization</div>
<div class="line">{</div>
<div class="line">    $orgService = $client-&gt;createService(OrganizationsService::class);</div>
<div class="line">    $orgs = $orgService-&gt;getOrgs()-&gt;getOrgs();</div>
<div class="line">    <span class="keywordflow">foreach</span> ($orgs as $org) {</div>
<div class="line">        <span class="keywordflow">if</span> ($org-&gt;getName() == $client-&gt;options[<span class="stringliteral">&quot;org&quot;</span>]) {</div>
<div class="line">            <span class="keywordflow">return</span> $org;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">null</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">$bucketsService = $client-&gt;createService(BucketsService::class);</div>
<div class="line"> </div>
<div class="line">$rule = <span class="keyword">new</span> BucketRetentionRules();</div>
<div class="line">$rule-&gt;setEverySeconds(3600);</div>
<div class="line"> </div>
<div class="line">$bucketName = <span class="stringliteral">&quot;example-bucket-&quot;</span> . microtime();</div>
<div class="line">$bucketRequest = <span class="keyword">new</span> PostBucketRequest();</div>
<div class="line">$bucketRequest-&gt;setName($bucketName)</div>
<div class="line">    -&gt;setRetentionRules([$rule])</div>
<div class="line">    -&gt;setOrgId(findMyOrg($client)-&gt;getId());</div>
<div class="line"> </div>
<div class="line"><span class="comment">//create bucket</span></div>
<div class="line">$respBucket = $bucketsService-&gt;postBuckets($bucketRequest);</div>
<div class="line">print $respBucket;</div>
<div class="line"> </div>
<div class="line">$client-&gt;close();</div>
<div class="ttc" id="aclass_influx_d_b2_1_1_model_1_1_bucket_retention_rules_html"><div class="ttname"><a href="class_influx_d_b2_1_1_model_1_1_bucket_retention_rules.html">InfluxDB2\Model\BucketRetentionRules</a></div><div class="ttdef"><b>Definition</b> BucketRetentionRules.php:44</div></div>
<div class="ttc" id="aclass_influx_d_b2_1_1_model_1_1_organization_html"><div class="ttname"><a href="class_influx_d_b2_1_1_model_1_1_organization.html">InfluxDB2\Model\Organization</a></div><div class="ttdef"><b>Definition</b> Organization.php:44</div></div>
<div class="ttc" id="aclass_influx_d_b2_1_1_model_1_1_post_bucket_request_html"><div class="ttname"><a href="class_influx_d_b2_1_1_model_1_1_post_bucket_request.html">InfluxDB2\Model\PostBucketRequest</a></div><div class="ttdef"><b>Definition</b> PostBucketRequest.php:44</div></div>
<div class="ttc" id="aclass_influx_d_b2_1_1_service_1_1_buckets_service_html"><div class="ttname"><a href="class_influx_d_b2_1_1_service_1_1_buckets_service.html">InfluxDB2\Service\BucketsService</a></div><div class="ttdef"><b>Definition</b> BucketsService.php:44</div></div>
<div class="ttc" id="aclass_influx_d_b2_1_1_service_1_1_organizations_service_html"><div class="ttname"><a href="class_influx_d_b2_1_1_service_1_1_organizations_service.html">InfluxDB2\Service\OrganizationsService</a></div><div class="ttdef"><b>Definition</b> OrganizationsService.php:44</div></div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md28"></a>
Writing via UDP</h2>
<p>Sending via UDP will be useful in cases when the execution time is critical to avoid potential delays (even timeouts) in sending metrics to the InfluxDB while are problems with the database or network connectivity. <br  />
 As is known, sending via UDP occurs without waiting for a response, unlike TCP (HTTP).</p>
<p>UDP Writer Requirements:</p><ol type="1">
<li>Installed ext-sockets</li>
<li>Since Influxdb 2.0+ does not support UDP protocol natively you need to install and configure Telegraf plugin: <a href="https://docs.influxdata.com/telegraf/v1.16/plugins/#socket_listener">https://docs.influxdata.com/telegraf/v1.16/plugins/#socket_listener</a></li>
<li>Extra config option passed to client: udpPort. Optionally you can specify udpHost, otherwise udpHost will parsed from url option</li>
<li>Extra config option passed to client: ipVersion. Optionally you can specify the ip version, defaults to IPv4</li>
</ol>
<div class="fragment"><div class="line">$client = <span class="keyword">new</span> <a class="code hl_class" href="class_influx_d_b2_1_1_client.html">InfluxDB2\Client</a>([<span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;http://localhost:8086&quot;</span>, <span class="stringliteral">&quot;token&quot;</span> =&gt; <span class="stringliteral">&quot;my-token&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;bucket&quot;</span> =&gt; <span class="stringliteral">&quot;my-bucket&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;org&quot;</span> =&gt; <span class="stringliteral">&quot;my-org&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;precision&quot;</span> =&gt; <a class="code hl_namespace" href="namespace_influx_d_b2.html">InfluxDB2</a>\Model\WritePrecision::NS,</div>
<div class="line">    <span class="stringliteral">&quot;udpPort&quot;</span> =&gt; 8094,</div>
<div class="line">    <span class="stringliteral">&quot;ipVersion&quot;</span> =&gt; 6,</div>
<div class="line">]);</div>
<div class="line">$writer = $client-&gt;createUdpWriter();</div>
<div class="line">$writer-&gt;write(<span class="stringliteral">&#39;h2o,location=west value=33i 15&#39;</span>);</div>
<div class="line">$writer-&gt;close();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md29"></a>
Delete data</h2>
<p>The <a href="/src/InfluxDB2/Service/DefaultService.php">DefaultService.php</a> supports deletes <a href="https://docs.influxdata.com/influxdb/latest/reference/syntax/line-protocol/">points</a> from an InfluxDB bucket.</p>
<div class="fragment"><div class="line">&lt;?php</div>
<div class="line">use <a class="code hl_class" href="class_influx_d_b2_1_1_client.html">InfluxDB2\Client</a>;</div>
<div class="line">use <a class="code hl_class" href="class_influx_d_b2_1_1_model_1_1_delete_predicate_request.html">InfluxDB2\Model\DeletePredicateRequest</a>;</div>
<div class="line">use <a class="code hl_class" href="class_influx_d_b2_1_1_service_1_1_delete_service.html">InfluxDB2\Service\DeleteService</a>;</div>
<div class="line"> </div>
<div class="line">$url = <span class="stringliteral">&#39;http://localhost:8086&#39;</span>;</div>
<div class="line">$token = <span class="stringliteral">&#39;my-token&#39;</span>;</div>
<div class="line">$org = <span class="stringliteral">&#39;my-org&#39;</span>;</div>
<div class="line">$bucket = <span class="stringliteral">&#39;my-bucket&#39;</span>;</div>
<div class="line"> </div>
<div class="line">$client = <span class="keyword">new</span> Client([</div>
<div class="line">    <span class="stringliteral">&quot;url&quot;</span> =&gt; $url,</div>
<div class="line">    <span class="stringliteral">&quot;token&quot;</span> =&gt; $token,</div>
<div class="line">    <span class="stringliteral">&quot;bucket&quot;</span> =&gt; $bucket,</div>
<div class="line">    <span class="stringliteral">&quot;org&quot;</span> =&gt; $org,</div>
<div class="line">    <span class="stringliteral">&quot;precision&quot;</span> =&gt; <a class="code hl_namespace" href="namespace_influx_d_b2.html">InfluxDB2</a>\Model\WritePrecision::S</div>
<div class="line">]);</div>
<div class="line"> </div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Delete data by measurement and tag value</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">$service = $client-&gt;createService(DeleteService::class);</div>
<div class="line"> </div>
<div class="line">$predicate = <span class="keyword">new</span> DeletePredicateRequest();</div>
<div class="line">$predicate-&gt;setStart(DateTime::createFromFormat(<span class="charliteral">&#39;Y&#39;</span>, <span class="stringliteral">&#39;2020&#39;</span>));</div>
<div class="line">$predicate-&gt;setStop(<span class="keyword">new</span> DateTime());</div>
<div class="line">$predicate-&gt;setPredicate(<span class="stringliteral">&quot;_measurement=\&quot;mem\&quot; AND host=\&quot;host1\&quot;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">$service-&gt;postDelete($predicate, <span class="keyword">null</span>, $org, $bucket);</div>
<div class="line"> </div>
<div class="line">$client-&gt;close();</div>
<div class="ttc" id="aclass_influx_d_b2_1_1_model_1_1_delete_predicate_request_html"><div class="ttname"><a href="class_influx_d_b2_1_1_model_1_1_delete_predicate_request.html">InfluxDB2\Model\DeletePredicateRequest</a></div><div class="ttdef"><b>Definition</b> DeletePredicateRequest.php:45</div></div>
<div class="ttc" id="aclass_influx_d_b2_1_1_service_1_1_delete_service_html"><div class="ttname"><a href="class_influx_d_b2_1_1_service_1_1_delete_service.html">InfluxDB2\Service\DeleteService</a></div><div class="ttdef"><b>Definition</b> DeleteService.php:44</div></div>
</div><!-- fragment --><p>For more details see <a href="examples/DeleteDataExample.php">DeleteDataExample.php</a>.</p>
<h2><a class="anchor" id="autotoc_md30"></a>
Proxy and redirects</h2>
<p>You can configure InfluxDB PHP client behind a proxy in two ways:</p>
<h4><a class="anchor" id="autotoc_md31"></a>
1. Using environment variable</h4>
<p>Set environment variable <code>HTTP_PROXY</code> or <code>HTTPS_PROXY</code> based on the scheme of your server url. For more info see Guzzle docs - <a href="https://docs.guzzlephp.org/en/5.3/clients.html?highlight=PROXY#environment-variables">environment Variables</a>.</p>
<h4><a class="anchor" id="autotoc_md32"></a>
2. Configure client to use proxy via Options</h4>
<p>You can pass a <code>proxy</code> configuration when creating the client: </p><div class="fragment"><div class="line">$client = <span class="keyword">new</span> <a class="code hl_class" href="class_influx_d_b2_1_1_client.html">InfluxDB2\Client</a>([</div>
<div class="line">  <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;http://localhost:8086&quot;</span>, </div>
<div class="line">  <span class="stringliteral">&quot;token&quot;</span> =&gt; <span class="stringliteral">&quot;my-token&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;bucket&quot;</span> =&gt; <span class="stringliteral">&quot;my-bucket&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;org&quot;</span> =&gt; <span class="stringliteral">&quot;my-org&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;proxy&quot;</span> =&gt; <span class="stringliteral">&quot;http://192.168.16.1:10&quot;</span>,</div>
<div class="line">]);</div>
</div><!-- fragment --><p> For more info see Guzzle docs - <a href="https://docs.guzzlephp.org/en/5.3/clients.html?highlight=PROXY#proxy">proxy</a>.</p>
<h3><a class="anchor" id="autotoc_md33"></a>
Redirects</h3>
<p>Client automatically follows HTTP redirects. You can configure redirects behaviour by a <code>allow_redirects</code> configuration: </p><div class="fragment"><div class="line">$client = <span class="keyword">new</span> <a class="code hl_class" href="class_influx_d_b2_1_1_client.html">InfluxDB2\Client</a>([</div>
<div class="line">  <span class="stringliteral">&quot;url&quot;</span> =&gt; <span class="stringliteral">&quot;http://localhost:8086&quot;</span>, </div>
<div class="line">  <span class="stringliteral">&quot;token&quot;</span> =&gt; <span class="stringliteral">&quot;my-token&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;bucket&quot;</span> =&gt; <span class="stringliteral">&quot;my-bucket&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;org&quot;</span> =&gt; <span class="stringliteral">&quot;my-org&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;allow_redirects&quot;</span> =&gt; <span class="keyword">false</span>,</div>
<div class="line">]);</div>
</div><!-- fragment --><p> For more info see Redirect Plugin docs - <a href="https://docs.php-http.org/en/latest/plugins/redirect.html#redirect-plugin">allow_redirects</a></p>
<h1><a class="anchor" id="autotoc_md34"></a>
Local tests</h1>
<p>Run once to install dependencies:</p>
<div class="fragment"><div class="line"> script</div>
<div class="line">make deps</div>
</div><!-- fragment --><p>Run unit &amp; intergration tests:</p>
<div class="fragment"><div class="line"> script</div>
<div class="line">make test</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md35"></a>
Contributing</h1>
<p>Bug reports and pull requests are welcome on GitHub at <a href="https://github.com/influxdata/influxdb-client-php">https://github.com/influxdata/influxdb-client-php</a>.</p>
<h1><a class="anchor" id="autotoc_md36"></a>
License</h1>
<p>The gem is available as open source under the terms of the <a href="https://opensource.org/licenses/MIT">MIT License</a>. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2
</small></address>
</div><!-- doc-content -->
</body>
</html>
